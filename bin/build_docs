#!/bin/sh

versions=$(python3 -c "import yaml; print(' '.join(yaml.safe_load(open('docs/_config.yml'))['versions_all'][:-1]))")

latest=$(python3 -c "import yaml; print(yaml.safe_load(open('docs/_config.yml'))['latest'])")

bin/build_docs_py

for v in $versions; do
	mkdir -p "docs/$v"
	git archive "v$v" docs/master | \
		tar xf - -C "docs/$v" --strip-components=2
	f=docs/$v/Installation/index.md
	sed -i "s/https:\/\/github\.com\/peterkuma\/ds-format\/archive\/refs\/heads\/master.zip/ds-format==$v/g" $f
done

ln -sf "$latest" docs/latest
